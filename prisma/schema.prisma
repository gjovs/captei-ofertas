// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id            String   @id @default(cuid())
  title         String
  affiliateLink String
  originalLink  String
  image         String
  price         Float
  originalPrice Float?
  couponCode    String?
  storeName     String   // Amazon, Shopee, Magalu, etc.
  category      String?  // Electronics, Fashion, Home, etc.
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([createdAt])
  @@index([storeName])
  @@index([category])
}

model Post {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  content   String   @db.Text
  published Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([published])
}

// Store conversation state for Telegram Bot
model BotSession {
  id        String   @id @default(cuid())
  chatId    BigInt   @unique
  state     String   // IDLE, WAITING_PRICE, WAITING_TITLE, etc.
  data      Json?    // Temporary storage for scraped data
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([chatId])
}

// Telegram groups where the bot will broadcast products/posts
model TelegramGroup {
  id              String   @id @default(cuid())
  chatId          BigInt   @unique  // Telegram group/channel ID
  title           String             // Group name
  notifyProducts  Boolean  @default(true)   // Send new product notifications?
  notifyBlog      Boolean  @default(true)   // Send new blog post notifications?
  addedAt         DateTime @default(now())

  @@index([chatId])
  @@index([notifyProducts])
  @@index([notifyBlog])
}
